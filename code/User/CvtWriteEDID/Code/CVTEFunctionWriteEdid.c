/********************************************************************************/
/*   The  Software  is  proprietary,  confidential,  and  valuable to Realtek   */
/*   Semiconductor  Corporation  ("CVTE").  All  rights, including but not   */
/*   limited  to  copyrights,  patents,  trademarks, trade secrets, mask work   */
/*   rights, and other similar rights and interests, are reserved to Realtek.   */
/*   Without  prior  written  consent  from  cvte,  copying, reproduction,   */
/*   modification,  distribution,  or  otherwise  is strictly prohibited. The   */
/*   Software  shall  be  kept  strictly  in  confidence,  and  shall  not be   */
/*   disclosed to or otherwise accessed by any third party.                     */
/*   c<2017> - <2017>                                                           */
/*   The Software is provided "AS IS" without any warranty of any kind,         */
/*   express, implied, statutory or otherwise.                                  */
/********************************************************************************/

//----------------------------------------------------------------------------------------------------
// ID Code      : CVTEFunctionWriteEdid.c No.0000
// Update Note  :
// Author       :xiangjianhe@20170523
//----------------------------------------------------------------------------------------------------
#include "UserCommonInclude.h"
#include "CVTEFunctionWriteEdid.h"

//****************************************************************************re
// CODE TABLES
//****************************************************************************
#if (CVT_EN_ON_LINE_WRITE_EDID == ENABLE)

//get for hengfa wa.dat@20170710
BYTE code CVTE_VGA_EDID[] =
{
#if((_PANEL_DH_WIDTH == 1600) && (_PANEL_DV_HEIGHT == 900)) //lenovo edid
    #if(_PROJECT == _CVT_RL6230_PROJECT)
    0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x30,0xAE,0xBF,0x61,0x01,0x01,0x01,0x01,
    0x27,0x1B,0x01,0x03,0x6C,0x2C,0x19,0x78,0x2E,0x2C,0xC5,0xA4,0x56,0x50,0xA1,0x28,
    0x0F,0x50,0x54,0xAF,0xEF,0x00,0x71,0x4F,0x81,0x80,0x81,0x8A,0x95,0x00,0x95,0x0A,
    0x95,0x0F,0x01,0x01,0x01,0x01,0x30,0x2A,0x40,0xC8,0x60,0x84,0x64,0x30,0x18,0x50,
    0x13,0x00,0xB0,0xF0,0x10,0x00,0x00,0x1E,0x00,0x00,0x00,0xFD,0x00,0x32,0x4B,0x1E,
    0x53,0x15,0x00,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x00,0x00,0x00,0xFC,0x00,0x54,
    0x45,0x32,0x30,0x2D,0x31,0x31,0x0A,0x20,0x20,0x20,0x20,0x20,0x00,0x00,0x00,0xFF,
    0x00,0x00,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x00,0xE4,
    #elif(_PROJECT == _CVT_RL6230_GREEN)
    0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x30,0xAE,0xDC,0x65,0x01,0x01,0x01,0x01,
    0x27,0x1B,0x01,0x03,0x6C,0x2C,0x19,0x78,0x2E,0x2C,0xC5,0xA4,0x56,0x50,0xA1,0x28,
    0x0F,0x50,0x54,0xAF,0xEF,0x00,0x71,0x4F,0x81,0x80,0x81,0x8A,0x95,0x00,0x95,0x0A,
    0x95,0x0F,0x01,0x01,0x01,0x01,0x30,0x2A,0x40,0xC8,0x60,0x84,0x64,0x30,0x18,0x50,
    0x13,0x00,0xB0,0xF0,0x10,0x00,0x00,0x1E,0x00,0x00,0x00,0xFD,0x00,0x32,0x4B,0x1E,
    0x53,0x15,0x00,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x00,0x00,0x00,0xFC,0x00,0x56,
    0x32,0x30,0x2D,0x31,0x30,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x00,0x00,0x00,0xFF,
    0x00,0x00,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x00,0xE7,    
    #else
    0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x30,0xAE,0xA9,0x65,0x01,0x01,0x01,0x01,
    0x19,0x18,0x01,0x03,0x6C,0x2C,0x19,0x78,0x2E,0x2C,0xC5,0xA4,0x56,0x50,0xA1,0x28,
    0x0F,0x50,0x54,0xAF,0xEF,0x00,0x71,0x4F,0x81,0x80,0x81,0x8A,0xA9,0xC0,0xA9,0xCF,
    0x95,0x00,0x01,0x01,0x01,0x01,0x30,0x2A,0x40,0xC8,0x60,0x84,0x64,0x30,0x18,0x50,
    0x13,0x00,0xB0,0xF0,0x10,0x00,0x00,0x1E,0x00,0x00,0x00,0xFF,0x00,0x0A,0x20,0x20,
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x00,0x00,0x00,0xFD,0x00,0x32,
    0x4B,0x1E,0x53,0x15,0x00,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x00,0x00,0x00,0xFC,
    0x00,0x4C,0x45,0x4E,0x20,0x4C,0x53,0x32,0x30,0x33,0x33,0x77,0x48,0x0A,0x00,0x4E,
    #endif
#else
    0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x05,0xE3,0x90,0x25,0xB5,0x69,0x0F,0x00,
    0x2A,0x1B,0x01,0x03,0x68,0x36,0x1E,0x78,0x2A,0xB6,0xE0,0xA3,0x56,0x50,0xA0,0x27,
    0x0E,0x50,0x54,0xBF,0xEF,0x00,0xD1,0xC0,0xB3,0x00,0x95,0x00,0x81,0x80,0x81,0x40,
    0x81,0xC0,0x01,0x01,0x01,0x01,0x02,0x3A,0x80,0x18,0x71,0x38,0x2D,0x40,0x58,0x2C,
    0x45,0x00,0x20,0x2F,0x21,0x00,0x00,0x1E,0x00,0x00,0x00,0xFD,0x00,0x32,0x4C,0x1E,
    0x53,0x13,0x00,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x00,0x00,0x00,0xFC,0x00,0x32,
    0x35,0x39,0x30,0x57,0x47,0x35,0x0A,0x20,0x20,0x20,0x20,0x20,0x00,0x00,0x00,0xFF,
    0x00,0x31,0x33,0x32,0x32,0x31,0x33,0x31,0x32,0x33,0x31,0x32,0x33,0x33,0x00,0xD2,  
#endif   
};

BYTE code CVTE_DVI_EDID[] =
{
    0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x05,0xE3,0x00,0x00,0x00,0x00,0x00,0x00,
    0x16,0x1A,0x01,0x03,0x80,0x30,0x1B,0x78,0x2E,0x35,0x85,0xA6,0x56,0x48,0x9A,0x24,
    0x12,0x50,0x54,0xBF,0xEF,0x80,0xB3,0x00,0xA9,0x40,0x95,0x00,0x81,0x80,0x81,0x40,
    0x01,0x01,0x01,0x01,0x01,0x01,0x02,0x3A,0x80,0x18,0x71,0x38,0x2D,0x40,0x58,0x2C,
    0x45,0x00,0xDD,0x0C,0x11,0x00,0x00,0x1E,0x00,0x00,0x00,0xFD,0x00,0x38,0x4B,0x1E,
    0x53,0x12,0x00,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x00,0x00,0x00,0xFC,0x00,0x44,
    0x56,0x49,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x00,0x00,0x00,0xFF,
    0x00,0x31,0x32,0x33,0x34,0x35,0x36,0x37,0x38,0x39,0x30,0x31,0x32,0x33,0x00,0x9D,
};

//get for hengfa wh.dat@20170710
BYTE code CVTE_HDMI1_EDID[] =
{
    0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x05,0xE3,0x90,0x25,0xB5,0x69,0x0F,0x00,
    0x2A,0x1B,0x01,0x03,0x80,0x36,0x1E,0x78,0x2A,0xB6,0xE0,0xA3,0x56,0x50,0xA0,0x27,
    0x0E,0x50,0x54,0xBF,0xEF,0x00,0xD1,0xC0,0xB3,0x00,0x95,0x00,0x81,0x80,0x81,0x40,
    0x81,0xC0,0x01,0x01,0x01,0x01,0x02,0x3A,0x80,0x18,0x71,0x38,0x2D,0x40,0x58,0x2C,
    0x45,0x00,0x20,0x2F,0x21,0x00,0x00,0x1E,0x00,0x00,0x00,0xFD,0x00,0x30,0x4C,0x1E,
    0x53,0x13,0x00,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x00,0x00,0x00,0xFC,0x00,0x32,
    0x35,0x39,0x30,0x57,0x47,0x35,0x0A,0x20,0x20,0x20,0x20,0x20,0x00,0x00,0x00,0xFF,
    0x00,0x31,0x33,0x32,0x32,0x31,0x33,0x31,0x32,0x33,0x31,0x32,0x33,0x33,0x01,0xBB,
    0x02,0x03,0x27,0xF1,0x4B,0x10,0x1F,0x05,0x14,0x04,0x13,0x03,0x12,0x02,0x11,0x01,
    0x23,0x09,0x07,0x07,0x83,0x01,0x00,0x00,0x65,0x03,0x0C,0x00,0x10,0x00,0x68,0x1A,
    0x00,0x00,0x01,0x01,0x30,0x4C,0x00,0x2A,0x44,0x80,0xA0,0x70,0x38,0x27,0x40,0x30,
    0x20,0x35,0x00,0x20,0x2F,0x21,0x00,0x00,0x1A,0x01,0x1D,0x00,0x72,0x51,0xD0,0x1E,
    0x20,0x6E,0x28,0x55,0x00,0x20,0x2F,0x21,0x00,0x00,0x1E,0x8C,0x0A,0xD0,0x8A,0x20,
    0xE0,0x2D,0x10,0x10,0x3E,0x96,0x00,0x20,0x2F,0x21,0x00,0x00,0x18,0x8C,0x0A,0xD0,
    0x90,0x20,0x40,0x31,0x20,0x0C,0x40,0x55,0x00,0x20,0x2F,0x21,0x00,0x00,0x18,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x51,
};

//get for hengfa wh2.dat@20170710
BYTE code CVTE_HDMI2_EDID[] =
{
    0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x05,0xE3,0x90,0x25,0xB5,0x69,0x0F,0x00,
    0x2A,0x1B,0x01,0x03,0x80,0x36,0x1E,0x78,0x2A,0xB6,0xE0,0xA3,0x56,0x50,0xA0,0x27,
    0x0E,0x50,0x54,0xBF,0xEF,0x00,0xD1,0xC0,0xB3,0x00,0x95,0x00,0x81,0x80,0x81,0x40,
    0x81,0xC0,0x01,0x01,0x01,0x01,0x02,0x3A,0x80,0x18,0x71,0x38,0x2D,0x40,0x58,0x2C,
    0x45,0x00,0x20,0x2F,0x21,0x00,0x00,0x1E,0x00,0x00,0x00,0xFD,0x00,0x30,0x4C,0x1E,
    0x53,0x13,0x00,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x00,0x00,0x00,0xFC,0x00,0x32,
    0x35,0x39,0x30,0x57,0x47,0x35,0x0A,0x20,0x20,0x20,0x20,0x20,0x00,0x00,0x00,0xFF,
    0x00,0x31,0x33,0x32,0x32,0x31,0x33,0x31,0x32,0x33,0x31,0x32,0x33,0x33,0x01,0xBB,
    0x02,0x03,0x27,0xF1,0x4B,0x10,0x1F,0x05,0x14,0x04,0x13,0x03,0x12,0x02,0x11,0x01,
    0x23,0x09,0x07,0x07,0x83,0x01,0x00,0x00,0x65,0x03,0x0C,0x00,0x20,0x00,0x68,0x1A,
    0x00,0x00,0x01,0x01,0x30,0x4C,0x00,0x2A,0x44,0x80,0xA0,0x70,0x38,0x27,0x40,0x30,
    0x20,0x35,0x00,0x20,0x2F,0x21,0x00,0x00,0x1A,0x01,0x1D,0x00,0x72,0x51,0xD0,0x1E,
    0x20,0x6E,0x28,0x55,0x00,0x20,0x2F,0x21,0x00,0x00,0x1E,0x8C,0x0A,0xD0,0x8A,0x20,
    0xE0,0x2D,0x10,0x10,0x3E,0x96,0x00,0x20,0x2F,0x21,0x00,0x00,0x18,0x8C,0x0A,0xD0,
    0x90,0x20,0x40,0x31,0x20,0x0C,0x40,0x55,0x00,0x20,0x2F,0x21,0x00,0x00,0x18,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x41,
};

BYTE code CVTE_HDMI3_EDID[] =
{
	0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x22,0x64,0x00,0x00,0x00,0x00,0x00,0x00,
	0x16,0x1A,0x01,0x03,0x80,0x30,0x1B,0x78,0x2A,0xA3,0xD0,0xA4,0x57,0x51,0xA0,0x25,
	0x10,0x50,0x54,0xBF,0xEF,0x80,0xD1,0xC0,0xB3,0x00,0xA9,0x40,0x95,0x00,0x81,0x80,
	0x81,0x40,0x71,0x4F,0x01,0x01,0x02,0x3A,0x80,0x18,0x71,0x38,0x2D,0x40,0x58,0x2C,
	0x45,0x00,0xDD,0x0C,0x11,0x00,0x00,0x1E,0x00,0x00,0x00,0xFF,0x00,0x31,0x32,0x33,
	0x34,0x35,0x36,0x37,0x38,0x39,0x30,0x31,0x32,0x33,0x00,0x00,0x00,0xFD,0x00,0x38,
	0x4B,0x1E,0x53,0x12,0x00,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x00,0x00,0x00,0xFC,
	0x00,0x48,0x50,0x32,0x32,0x35,0x50,0x4A,0x42,0x0A,0x20,0x20,0x20,0x20,0x01,0x65,
	0x02,0x03,0x22,0xF2,0x4A,0x9F,0x90,0x14,0x13,0x12,0x1E,0x01,0x04,0x05,0x03,0x23,
	0x09,0x07,0x07,0x83,0x01,0x00,0x00,0x67,0x03,0x0C,0x00,0x10,0x00,0x00,0x1E,0xE2,
	0x00,0x4F,0x8C,0x0A,0xD0,0x8A,0x20,0xE0,0x2D,0x10,0x10,0x3E,0x96,0x00,0xDD,0x0C,
	0x11,0x00,0x00,0x18,0x01,0x1D,0x80,0x18,0x71,0x1C,0x16,0x20,0x58,0x2C,0x25,0x00,
	0xDD,0x0C,0x11,0x00,0x00,0x9E,0x02,0x3A,0x80,0x18,0x71,0x38,0x2D,0x40,0x58,0x2C,
	0x45,0x00,0xDD,0x0C,0x11,0x00,0x00,0x1E,0x01,0x1D,0x80,0xD0,0x72,0x1C,0x16,0x20,
	0x10,0x2C,0x25,0x80,0xDD,0x0C,0x11,0x00,0x00,0x9E,0x02,0x3A,0x80,0xD0,0x72,0x38,
	0x2D,0x40,0x10,0x2C,0x45,0x80,0xDD,0x0C,0x11,0x00,0x00,0x1E,0x00,0x00,0x00,0x68,
};

BYTE code CVTE_HEAD_EDID[] =
{
    0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,
};


BYTE ucEDIDBuffer[256];
BYTE ucEDIDWeekYearBuffer[2];

BYTE ucEDIDBuffer_HEAD[EDID_HEAD_LEN];
BYTE ucEDIDBuffer_SN[EDID_SN_LEN];

BYTE *EDIDBuffer = ucEDIDBuffer;
BYTE *EDIDBuffer_HEAD = ucEDIDBuffer_HEAD;
BYTE *EDIDBuffer_SN = ucEDIDBuffer_SN;

BYTE GetVGA_EDIDChecksum(void)
{
    return CVTE_VGA_EDID[0x7F];
}

BYTE GetHDMI1_EDIDChecksum(void)
{
    return CVTE_HDMI1_EDID[0x7F];
}

BYTE GetHDMI2_EDIDChecksum(void)
{
    return CVTE_HDMI2_EDID[0x7F];
}

//--------------------------------------------------
// Description  : CEepromEdidWrite
// Input Value  : None
// Output Value : None
//--------------------------------------------------
bit CEepromEdidWrite(WORD usSubAddr, WORD usLength, BYTE *pWriteArray,BYTE usEdidType)
{
    BYTE bEdidStatus;
    BYTE bEdidWpStatus;

    PCB_PIN_SHARE_TO_EE_EDID(usEdidType);

    bEdidWpStatus = EDID_WP_STATUS();

    PCB_A0_EDID_EEPROM_WRITE_PROTECT(_EDID_WP_DISABLE);

    #if(_SW_IIC_SUPPORT == _ON)
    bEdidStatus = UserCommonEepromIICWrite(_EEPROM_SLAVE_ADDRESS, usSubAddr, 1, usLength, pWriteArray, GET_SW_IIC_STATUS(), _SW_IIC_PIN_GPIO, _WRITE_SIZE_8);
    #endif

    PCB_PIN_SHARE_TO_EE_EDID(_ON_LINE_EDID_NON);

    if(bEdidWpStatus)
    {
       PCB_A0_EDID_EEPROM_WRITE_PROTECT(_EDID_WP_ENABLE);
    }
    else
    {
       PCB_A0_EDID_EEPROM_WRITE_PROTECT(_EDID_WP_DISABLE);
    }

    if(bEdidStatus == _FAIL)
    {
        return _FAIL;
    }
    else
    {
        return _SUCCESS;
    }
}

//--------------------------------------------------
// Description  : CEepromEdidRead
// Input Value  : None
// Output Value : None
//--------------------------------------------------
bit CEepromEdidRead(WORD usSubAddr, WORD usLength, BYTE *pReadArray,BYTE usEdidType)
{
    BYTE bEdidStatus;

    PCB_PIN_SHARE_TO_EE_EDID(usEdidType);

    #if(_SW_IIC_SUPPORT == _ON)
    bEdidStatus = UserCommonEepromIICRead(_EEPROM_SLAVE_ADDRESS, usSubAddr, 1, usLength, pReadArray, GET_SW_IIC_STATUS(), _SW_IIC_PIN_GPIO);
    #endif

    PCB_PIN_SHARE_TO_EE_EDID(_ON_LINE_EDID_NON);

    if(bEdidStatus == _FAIL)
    {
        return _FAIL;
    }
    else
    {
        return _SUCCESS;
    }
}

//--------------------------------------------------
// Description  : EdidDateRead
// Input Value  : None
// Output Value : None
//--------------------------------------------------
void EdidDateRead(BYTE Port)
{
	switch(Port)
	{
        case _ON_LINE_EDID_VGA:
            CEepromEdidRead(0x00, EDID_VGA_LEN, EDIDBuffer,_ON_LINE_EDID_VGA);
            break;
    	
    	case _ON_LINE_EDID_DVI:
            CEepromEdidRead(0x00, EDID_DVI_LEN, EDIDBuffer,_ON_LINE_EDID_DVI);
            break;
    	
        case _ON_LINE_EDID_HDMI1:
            CEepromEdidRead(0x00, EDID_HDMI_LEN, EDIDBuffer,_ON_LINE_EDID_HDMI1);
            break;

        case _ON_LINE_EDID_HDMI2:
            CEepromEdidRead(0x00, EDID_HDMI_LEN, EDIDBuffer,_ON_LINE_EDID_HDMI2);
            break;

        case _ON_LINE_EDID_HDMI3:
            CEepromEdidRead(0x00, EDID_HDMI_LEN, EDIDBuffer,_ON_LINE_EDID_HDMI3);
            break;  

        default:
            break;
	}
}

//--------------------------------------------------
// Description  : EDIDCheckHead
// Input Value  : None
// Output Value : None
//--------------------------------------------------
bit EDIDCheckHead(void)
{
	BYTE temp;
	for(temp=0;temp<EDID_HEAD_LEN;temp++)
	{
	    EDIDBuffer_HEAD[temp] = CVTE_HEAD_EDID[temp];
	    if (EDIDBuffer[EDID_HEAD_ADDR+temp] != EDIDBuffer_HEAD[EDID_HEAD_ADDR+temp])
		{
            return _FALSE;
		}
	}
    return _TRUE;
}

//--------------------------------------------------
// Description  : EDIDCheckYearWeek
// Input Value  : None
// Output Value : None
//--------------------------------------------------
bit EDIDCheckYearWeek(void)
{
    if (EDIDBuffer[EDID_WEEK_ADDR]<1 || EDIDBuffer[EDID_WEEK_ADDR]>53) 	//Week
    {
        return _FALSE;
    }
    if (EDIDBuffer[EDID_YEAR_ADDR]>(EDID_DEFAULT_MFG_YEAR-1990))//Year
    {
        return _FALSE;
    }
    return _TRUE;
}

//--------------------------------------------------
// Description  : 
// Input Value  : 
// Output Value : 
//--------------------------------------------------
bit EdidSnCmp( const char *string1, const char *string2, int count )
{
    int iRet, i;

    for ( i = 0; i < count; i++ )
    {
        iRet = string1[i] - string2[i];
        if ( iRet != 0)
        {
            return _TRUE;
        }
    }

    return _FALSE;
}

//--------------------------------------------------
// Description  : StoredSnAddr
// Input Value  : None
// Output Value : None
//--------------------------------------------------
BYTE StoredSnAddr(void)
{
    BYTE addr = 0x48;
    BYTE Addr = 0;
    BYTE Data[5] = {0x00,0x00,0x00,0xFF,0x00};
    
    if (EdidSnCmp(EDIDBuffer + addr, Data, sizeof(Data)) == _FALSE) 
    {
        return (addr+5);//block 1  + 5 is SN Headle size
    }
    else if (EdidSnCmp(EDIDBuffer + addr +18, Data, sizeof(Data)) == _FALSE) 
    {
        return (addr+18+5); //block 2 [Len = 18] + 5 is SN Headle size
    }
    else if (EdidSnCmp(EDIDBuffer + addr +36, Data, sizeof(Data))  == _FALSE) 
    {
        return (addr+36+5); //block 3 [Len = 18] + 5 is SN Headle size
    }
    else 
    {
        return 0;
    }
}

//--------------------------------------------------
// Description  : EDIDCheckSN
// Input Value  : None
// Output Value : None
//--------------------------------------------------
bit EDIDCheckSN(void)
{
    BYTE temp;
    BYTE ucAddr = StoredSnAddr();

    for (temp=0;temp<EDID_SN_LEN;temp++) // [temp = 5 is Monitor S/N handle size,so begin start must ucAddr+5] + 5 is SN Headle size
	{
	    if (!((EDIDBuffer[ucAddr+temp]>=0x30 && EDIDBuffer[ucAddr+temp]<=0x39) || (EDIDBuffer[ucAddr+temp]>=0x41 && EDIDBuffer[ucAddr+temp]<=0x5A)))
		{
            return _FALSE;
		}
	}
    return _TRUE;
}

//--------------------------------------------------
// Description  : CVTEEDIDCheck
// Input Value  : None
// Output Value : None
//--------------------------------------------------
bit CVTEEDIDCheck(void)
{
    if((EDIDCheckHead() == _TRUE) && (EDIDCheckYearWeek() == _TRUE) && (EDIDCheckSN() == _TRUE))
    {
        return _TRUE;
	}
	else
	{
		return _FALSE;
	}
}

//--------------------------------------------------
// Description  : GetEdidSN
// Input Value  : None
// Output Value : None
//--------------------------------------------------
bit GetEdidSN(BYTE Port)
{
    WORD i;
    BYTE ucAddr = 0;

    EdidDateRead(Port);
    
    ucAddr = StoredSnAddr();
        
	if((CVTEEDIDCheck() == _TRUE) && (ucAddr >= (0x48+5))) //After 0x48+5 is the SN number + 5 is SN Headle size
	{	
    	for(i=0;i<EDID_SN_LEN;i++)	
    	{
            EDIDBuffer_SN[i] = EDIDBuffer[ucAddr+i];    
    	}
        
        for(i=0; i<2; i++)
        {
            ucEDIDWeekYearBuffer[i]=EDIDBuffer[EDID_WEEK_ADDR+i];
        }             
		return _TRUE;
	}
	else
	{
        return _FALSE;
	}    	
}

//--------------------------------------------------
// Description  : SyncEdidWeek
// Input Value  : None
// Output Value : None
//--------------------------------------------------
void SyncEdidWeek(void)
{
    EDIDBuffer[EDID_WEEK_ADDR] = ucEDIDWeekYearBuffer[0];
}

//--------------------------------------------------
// Description  : SyncEdidYear
// Input Value  : None
// Output Value : None
//--------------------------------------------------
void SyncEdidYear(void)
{
    EDIDBuffer[EDID_YEAR_ADDR] = ucEDIDWeekYearBuffer[1];
}

//--------------------------------------------------
// Description  : SyncEdidSNNum
// Input Value  : None
// Output Value : None
//--------------------------------------------------
void SyncEdidSNNum(void)
{
    BYTE i, j;
    BYTE ucAddr = StoredSnAddr();

	for(i=0;i<EDID_SN_LEN;i++)
	{
	    if((CVTEEDIDCheck() == _TRUE) && (ucAddr >= (0x48+5))) //After 0x48+5 is the SN number + 5 is SN Headle size
        {   
        	if(EDIDBuffer[ucAddr + i] != EDIDBuffer_SN[i])
        	{
        	    for(j=0;j<EDID_SN_LEN;j++)
        	    {
                    EDIDBuffer[ucAddr + j] = EDIDBuffer_SN[j];
        	    }
    			break;
        	}
        }
	}
}

//--------------------------------------------------
// Description  : LoadDefEdid
// Input Value  : None
// Output Value : None
//--------------------------------------------------
void LoadDefEdid(WORD usLength, BYTE usEdidType)
{
    WORD i;
	switch(usEdidType)
	{
	    case _ON_LINE_EDID_VGA:
            for(i=0;i<usLength;i++)
            { 
                EDIDBuffer[i] = CVTE_VGA_EDID[i];     
            }
		break;
		
		case _ON_LINE_EDID_DVI:	
    		for(i=0;i<usLength;i++)
            { 
                EDIDBuffer[i] = CVTE_DVI_EDID[i];     
            }
		break;
		
		case _ON_LINE_EDID_HDMI1:	
    		for(i=0;i<usLength;i++)
            { 
                EDIDBuffer[i] = CVTE_HDMI1_EDID[i];     
            }
		break;	

		case _ON_LINE_EDID_HDMI2:	
    		for(i=0;i<usLength;i++)
            { 
                EDIDBuffer[i] = CVTE_HDMI2_EDID[i];     
            }
		break;

		case _ON_LINE_EDID_HDMI3:	
    		for(i=0;i<usLength;i++)
            { 
                EDIDBuffer[i] = CVTE_HDMI3_EDID[i];     
            }
		break;

        default:
        break;          
        
	}
    CEepromEdidWrite(0x00,usLength,EDIDBuffer,usEdidType);
}

//--------------------------------------------------
// Description  : SyncVgaEdid
// Input Value  : None
// Output Value : None
//--------------------------------------------------
void SyncVgaEdid(void)
{
    BYTE i, usCheckSum = 0;
    
	SyncEdidWeek();
	SyncEdidYear();
	//SyncEdidPanelSize();
	SyncEdidSNNum();
    for(i=0; i<127; i++)
	{
		usCheckSum += EDIDBuffer[i];
	}
	if(EDIDBuffer[127] != (0x100-usCheckSum))
	{
	    EDIDBuffer[127] = 0x100-usCheckSum;
	    CEepromEdidWrite(0x00,EDID_VGA_LEN,EDIDBuffer,_ON_LINE_EDID_VGA);
    }	
}

//--------------------------------------------------
// Description  : SyncDviEdid
// Input Value  : None
// Output Value : None
//--------------------------------------------------
void SyncDviEdid(void)
{
    BYTE i, usCheckSum = 0;
    
	EdidDateRead(_ON_LINE_EDID_DVI);
	if(CVTEEDIDCheck() == _TRUE)
	{
        SyncEdidWeek();
    	SyncEdidYear();
    	//SyncEdidPanelSize();
    	SyncEdidSNNum(); 
		for(i=0; i<127; i++)
	    {
		    usCheckSum += EDIDBuffer[i];
    	}
    	if(EDIDBuffer[127] != (0x100-usCheckSum))
    	{
    	    EDIDBuffer[127] = 0x100-usCheckSum;
    	    CEepromEdidWrite(0x00,EDID_DVI_LEN,EDIDBuffer,_ON_LINE_EDID_DVI);
        }	
	}
	else
	{
        LoadDefEdid(EDID_DVI_LEN, _ON_LINE_EDID_DVI);
		EdidDateRead(_ON_LINE_EDID_DVI);
		SyncEdidWeek();
    	SyncEdidYear();
    	//SyncEdidPanelSize();
    	SyncEdidSNNum(); 
		for(i=0; i<127; i++)
	    {
		    usCheckSum += EDIDBuffer[i];
    	}
    	if(EDIDBuffer[127] != (0x100-usCheckSum))
    	{
    	    EDIDBuffer[127] = 0x100-usCheckSum;
    	    CEepromEdidWrite(0x00,EDID_DVI_LEN,EDIDBuffer,_ON_LINE_EDID_DVI);
        }
		if(CVTEEDIDCheck() == _TRUE)
		{
            return;
		}
		else
		{
            LoadDefEdid(EDID_DVI_LEN, _ON_LINE_EDID_DVI);
		}
	}
}

//--------------------------------------------------
// Description  : SyncHdmiEdid
// Input Value  : None
// Output Value : None
//--------------------------------------------------
void SyncHdmiEdid(BYTE SyncSource)
{
    WORD i; 
	BYTE usCheckSum = 0;
	
	EdidDateRead(SyncSource);
	if(CVTEEDIDCheck() == _TRUE)
	{
        SyncEdidWeek();
    	SyncEdidYear();
    	//SyncEdidPanelSize();
    	SyncEdidSNNum();  
		for(i=0; i<127; i++)
	    {
		    usCheckSum += EDIDBuffer[i];
    	}
    	if(EDIDBuffer[127] != (0x100-usCheckSum))
    	{
    	    EDIDBuffer[127] = 0x100-usCheckSum;
    	    CEepromEdidWrite(0x00,EDID_HDMI_LEN,EDIDBuffer,SyncSource);
        }	
	}
	else
	{
        LoadDefEdid(EDID_HDMI_LEN, SyncSource);
		EdidDateRead(SyncSource);
		SyncEdidWeek();
    	SyncEdidYear();
    	//SyncEdidPanelSize();
    	SyncEdidSNNum();  
		for(i=0; i<127; i++)
	    {
		    usCheckSum += EDIDBuffer[i];
    	}
    	if(EDIDBuffer[127] != (0x100-usCheckSum))
    	{
    	    EDIDBuffer[127] = 0x100-usCheckSum;
    	    CEepromEdidWrite(0x00,EDID_HDMI_LEN, EDIDBuffer, SyncSource);
        }
		if(CVTEEDIDCheck() == _TRUE)
		{
            return; 
		}
		else
		{
            LoadDefEdid(EDID_HDMI_LEN, SyncSource);
		}
	}
}

//--------------------------------------------------
// Description  : EDIDSyncProcess
// Input Value  : None
// Output Value : None
//--------------------------------------------------
void EDIDSyncProcess(void)
{
    if(GetEdidSN(EDID_DEFAULT_SYNC_PORT) == _TRUE)
    {
        SyncVgaEdid();
		SyncDviEdid();
		SyncHdmiEdid(_ON_LINE_EDID_HDMI1);
        SyncHdmiEdid(_ON_LINE_EDID_HDMI2);
        SyncHdmiEdid(_ON_LINE_EDID_HDMI3);
    }
	else
	{       
	    LoadDefEdid(EDID_DEFAULT_SYNC_LEN, EDID_DEFAULT_SYNC_PORT);
		if(GetEdidSN(EDID_DEFAULT_SYNC_PORT) == _TRUE)
		{
    		SyncVgaEdid();
    		SyncDviEdid();
    		SyncHdmiEdid(_ON_LINE_EDID_HDMI1);
            SyncHdmiEdid(_ON_LINE_EDID_HDMI2);
            SyncHdmiEdid(_ON_LINE_EDID_HDMI3);
		}
		else
		{
            LoadDefEdid(EDID_VGA_LEN, _ON_LINE_EDID_VGA);
			LoadDefEdid(EDID_DVI_LEN, _ON_LINE_EDID_DVI);
			LoadDefEdid(EDID_HDMI_LEN, _ON_LINE_EDID_HDMI1);
            LoadDefEdid(EDID_HDMI_LEN, _ON_LINE_EDID_HDMI2);
            LoadDefEdid(EDID_HDMI_LEN, _ON_LINE_EDID_HDMI3);
		}
	}    
}
//--------------------------------------------------
// Description  : SetAllDDCPortInitialDDC
// Input Value  : None
// Output Value : None
//--------------------------------------------------
void SetAllDDCPortInitialDDC(void)
{
    ScalerPinshareGpioDdcPinSwitch(_DDC1_SWITCH_DDC);
    ScalerPinshareGpioDdcPinSwitch(_DDC2_SWITCH_DDC);
    ScalerPinshareGpioDdcPinSwitch(_DDC3_SWITCH_DDC);
}


//--------------------------------------------------
// Description  : Check all kinds of port's EDID is Valid or not
// Input Value  : None
// Output Value : None
//--------------------------------------------------
void Cvt_Check_Exteranl_EDID(BYTE PortType,int Len)
{
    BYTE Calchecksum=0,Res=0;
    BYTE i=0;

    EdidDateRead(PortType);
    
    for(i=0;i<0x7F;i++)
    {
        Calchecksum+=EDIDBuffer[i];
    }
    
    Calchecksum=0x100-Calchecksum;
    
    if(Calchecksum!=EDIDBuffer[0x7F])//If the checksum is wrong reload the EDID
    {
        Res |= 0x01;
    }
    
    if (Len == 0x100)
    {
        Calchecksum = 0;
        for(i=0x80;i<0xFF;i++)
        {
            Calchecksum+=EDIDBuffer[i];
        }
        Calchecksum=0x100-Calchecksum;
        if(Calchecksum!=EDIDBuffer[0xFF])//If the checksum is wrong reload the EDID
        {
            Res |= 0x02;
        }
    }
    
    if (Res&0x01 || Res&0x02)
    {
        FC_EDID_EEPROM_WP_DISABLE();
        LoadDefEdid(Len, PortType);
        SetAllDDCPortInitialDDC();
        FC_EDID_EEPROM_WP_ENABLE();
    }
}

//--------------------------------------------------
// Description  : COsdFactoryCheckEdidProcess
// Input Value  : None
// Output Value : None
//--------------------------------------------------
void COsdFactoryCheckEdidProcess(void)
{
    int flag = EDID_SYNC_MODE;
    
    if(flag == EDID_NORMAL_MODE)//remove the compiler warnings becase of the following functions won't be called.
    { 
        FC_EDID_EEPROM_WP_DISABLE();
        EDIDSyncProcess();
        SetAllDDCPortInitialDDC();
        FC_EDID_EEPROM_WP_ENABLE();
    }
    else if(flag == EDID_AOC_MODE)
    {
        Cvt_Check_Exteranl_EDID(_ON_LINE_EDID_VGA,EDID_HDMI_LEN);                        
        Cvt_Check_Exteranl_EDID(_ON_LINE_EDID_DVI,EDID_DVI_LEN);
        Cvt_Check_Exteranl_EDID(_ON_LINE_EDID_HDMI1,EDID_HDMI_LEN);
        Cvt_Check_Exteranl_EDID(_ON_LINE_EDID_HDMI2,EDID_HDMI_LEN);
        Cvt_Check_Exteranl_EDID(_ON_LINE_EDID_HDMI3,EDID_HDMI_LEN);
    }
    else
    {
        FC_EDID_EEPROM_WP_DISABLE();
        EDIDSyncProcess();
        SetAllDDCPortInitialDDC();
        FC_EDID_EEPROM_WP_ENABLE();
    }
}

//--------------------------------------------------
// Description  : CosdFactoryEdidSyncSouce
// Input Value  : None
// Output Value : None
//--------------------------------------------------
#if(CVT_EN_SYNC_EDID_SUPPORT == ENABLE)
void CosdFactoryEdidSyncSouce(void)
{
    FC_EDID_EEPROM_WP_DISABLE();
    EDIDSyncProcess();
    SetAllDDCPortInitialDDC();
    FC_EDID_EEPROM_WP_ENABLE();
}
#endif

//--------------------------------------------------
// Description  : COsdEEPROMLoadDefualtEdid
// Input Value  : None
// Output Value : None
//--------------------------------------------------
void COsdEEPROMLoadDefualtEdid(void)
{
    FC_EDID_EEPROM_WP_DISABLE();
    #if(_SCALER_TYPE == _RL6230_SERIES)
    LoadDefEdid(EDID_VGA_LEN, _ON_LINE_EDID_VGA);
    #elif (_SCALER_TYPE == _RL6336_SERIES)
    LoadDefEdid(EDID_VGA_LEN, _ON_LINE_EDID_VGA);
    LoadDefEdid(EDID_DVI_LEN, _ON_LINE_EDID_DVI);
    #else
    LoadDefEdid(EDID_VGA_LEN, _ON_LINE_EDID_VGA);
	LoadDefEdid(EDID_DVI_LEN, _ON_LINE_EDID_DVI);
	LoadDefEdid(EDID_HDMI_LEN, _ON_LINE_EDID_HDMI1);
    LoadDefEdid(EDID_HDMI_LEN, _ON_LINE_EDID_HDMI2);
    LoadDefEdid(EDID_HDMI_LEN, _ON_LINE_EDID_HDMI3);
    #endif
    SetAllDDCPortInitialDDC();
    FC_EDID_EEPROM_WP_ENABLE();
}

/******************************************************************************
 * FUNCTION: TPVEDIDCheck ( )
 * DESCRIPTION: Check whether burn EDID or not 
 * TPV Factory user
 ******************************************************************************/
bit TPVEDIDCheck(void)
{
    BYTE checksum=0;
    
    CEepromEdidRead(0x7F,1,&checksum,_ON_LINE_EDID_VGA);
    if(checksum == GetVGA_EDIDChecksum())return _FALSE;

    CEepromEdidRead(0x7F,1,&checksum,_ON_LINE_EDID_HDMI1);
    if(checksum == GetHDMI1_EDIDChecksum())return _FALSE;

    CEepromEdidRead(0x7F,1,&checksum,_ON_LINE_EDID_HDMI2);
    if(checksum == GetHDMI2_EDIDChecksum())return _FALSE;
    
    SetAllDDCPortInitialDDC();
    return _TRUE;
}
#endif // End of #if(CVT_EN_ON_LINE_WRITE_EDID == ENABLE)

